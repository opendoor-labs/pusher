# Pusher

Pusher is a publish-subscribe system that uses WebSockets to deliver low-latency messages from a
server to a client application.

An example use case is pushing Chrome desktop notifications when an operator receives an incoming
phone calls and SMSs from customers.

## User Guide

### Publisher

Currently, only Web is set up as a publisher. Use
[pusher_job.rb](https://github.com/opendoor-labs/web/blob/master/app/jobs/pusher_job.rb)
for the typical asynchronous use case, or
[pusher_client.rb](https://github.com/opendoor-labs/web/blob/master/app/services/pusher_client.rb)
if synchronous guarantees are required.

Publishers must authenticate with a shared secret.

[Publisher example PR](https://github.com/opendoor-labs/web/pull/30535)

### Subscriber

Apps subscribe to Pusher via WebSocket
[like this](https://github.com/opendoor-labs/web/blob/master/app/assets/javascripts/common/services/pusher.js).
Apps must have a valid JWT with claims that are validated by the Pusher server. Currently, JWTs are
[generated by Web](https://github.com/opendoor-labs/web/blob/master/app/helpers/guardian_helper.rb)
and delivered in the form of a `<meta>` tag with the initial server-side render.

[Subscriber example PR](https://github.com/opendoor-labs/web/pull/30530)

## Development

Running locally:
* clone the repo
* `docker-compose up`. This will give you a local pusher running at http://localhost:8585

### Erlang version
Pusher doesn't compile on newer versions of Erlang. It works if erlang is pinned to 1.5 like in the Dockerfile.
